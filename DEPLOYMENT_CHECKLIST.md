# 英検マスター - 部署チェックリスト

このドキュメントは、英検マスターシステムを本番環境に部署する際の完全なチェックリストです。

## 部署前の準備

### サーバー選択
- [ ] Hetzner Cloud アカウントを作成
- [ ] 適切なサーバータイプを選択（推奨：CPX11 以上）
- [ ] リージョンを選択（アジア向けはシンガポール推奨）
- [ ] SSH キーペアを生成
- [ ] ファイアウォールルールを設定

### ドメイン準備
- [ ] ドメイン名を取得
- [ ] DNS プロバイダーにアクセス
- [ ] DNS レコードを準備（A レコード、CNAME など）
- [ ] メールアドレスを用意（SSL 証明書用）

### リポジトリ準備
- [ ] GitHub アカウントを作成
- [ ] リポジトリを作成
- [ ] コードをプッシュ
- [ ] `.gitignore` が正しく設定されているか確認
- [ ] 機密情報が含まれていないか確認

## サーバーセットアップ

### 初期設定
- [ ] Hetzner コンソールでサーバーを作成
- [ ] サーバーが起動するまで待機
- [ ] SSH で接続確認
- [ ] システムを更新（apt update && apt upgrade）
- [ ] 必要なパッケージをインストール

### 環境構築
- [ ] Python 3.11 をインストール
- [ ] Node.js 18 をインストール
- [ ] Git をインストール
- [ ] Docker をインストール（オプション）
- [ ] Docker Compose をインストール（オプション）

### セキュリティ設定
- [ ] SSH キーベース認証を設定
- [ ] パスワードログインを無効化
- [ ] ファイアウォール（UFW）を有効化
- [ ] ポート 22, 80, 443 を許可
- [ ] 不要なサービスを無効化

## アプリケーションデプロイ

### コードデプロイ
- [ ] リポジトリをクローン
- [ ] 依存関係をインストール（Python）
- [ ] 依存関係をインストール（Node.js）
- [ ] フロントエンドをビルド
- [ ] データベースを初期化
- [ ] サンプルデータを投入

### サービス設定
- [ ] Systemd サービスファイルを作成
- [ ] サービスを有効化
- [ ] サービスを起動
- [ ] サービスステータスを確認
- [ ] ログを確認

### Nginx 設定
- [ ] Nginx をインストール
- [ ] Nginx 設定ファイルを作成
- [ ] 設定をテスト（nginx -t）
- [ ] Nginx を起動
- [ ] Nginx を有効化

## SSL/TLS 設定

### Let's Encrypt 証明書
- [ ] Certbot をインストール
- [ ] 証明書を取得
- [ ] Nginx 設定を更新
- [ ] HTTPS リダイレクトを設定
- [ ] 証明書の自動更新を設定

### 証明書検証
- [ ] ブラウザで HTTPS アクセスを確認
- [ ] 証明書の有効期限を確認
- [ ] 自動更新が機能しているか確認
- [ ] SSL テストを実行（https://www.ssllabs.com）

## DNS 設定

### DNS レコード設定
- [ ] A レコードを設定（@ → サーバー IP）
- [ ] www CNAME を設定（www → @）
- [ ] DNS の伝播を待機（最大 48 時間）
- [ ] DNS 解決を確認（nslookup、dig）

### ドメイン検証
- [ ] ドメインでアクセス可能か確認
- [ ] www サブドメインでアクセス可能か確認
- [ ] メール設定が必要な場合は MX レコードを設定

## アプリケーション検証

### バックエンド API テスト
- [ ] ヘルスチェック：`curl https://eiken.example.com/health`
- [ ] 問題取得：`curl https://eiken.example.com/api/questions/5級`
- [ ] テスト開始：POST リクエストをテスト
- [ ] 答え提出：POST リクエストをテスト
- [ ] 結果取得：GET リクエストをテスト

### フロントエンド テスト
- [ ] ホームページが表示されるか確認
- [ ] 級別選択が機能するか確認
- [ ] テスト開始が機能するか確認
- [ ] 答題が機能するか確認
- [ ] 結果表示が機能するか確認
- [ ] ダッシュボードが表示されるか確認

### ブラウザ互換性テスト
- [ ] Chrome で動作確認
- [ ] Firefox で動作確認
- [ ] Safari で動作確認
- [ ] Edge で動作確認
- [ ] モバイルブラウザで動作確認

## パフォーマンス検証

### ロード時間テスト
- [ ] ホームページのロード時間を測定
- [ ] API レスポンスタイムを測定
- [ ] 画像の読み込み時間を測定
- [ ] 全体のロード時間が 3 秒以下か確認

### リソース使用状況
- [ ] CPU 使用率を確認
- [ ] メモリ使用率を確認
- [ ] ディスク使用率を確認
- [ ] ネットワーク帯域幅を確認

### 負荷テスト
- [ ] Apache Bench でテスト：`ab -n 1000 -c 10 https://eiken.example.com`
- [ ] wrk でテスト：`wrk -t4 -c100 -d30s https://eiken.example.com`
- [ ] エラーが発生しないか確認
- [ ] レスポンスタイムが許容範囲か確認

## バックアップと復旧

### バックアップ設定
- [ ] バックアップスクリプトを作成
- [ ] バックアップディレクトリを作成
- [ ] Cron ジョブを設定（毎日実行）
- [ ] バックアップが実行されているか確認
- [ ] バックアップファイルが存在するか確認

### 復旧テスト
- [ ] バックアップから復旧するテストを実行
- [ ] データが正しく復旧されるか確認
- [ ] アプリケーションが正常に動作するか確認

## モニタリング設定

### ログ設定
- [ ] Nginx アクセスログを設定
- [ ] Nginx エラーログを設定
- [ ] アプリケーションログを設定
- [ ] ログローテーションを設定
- [ ] ログが記録されているか確認

### アラート設定
- [ ] ディスク容量アラートを設定
- [ ] CPU 使用率アラートを設定
- [ ] メモリ使用率アラートを設定
- [ ] サービスダウンアラートを設定
- [ ] エラーレートアラートを設定

### モニタリングツール
- [ ] Hetzner Cloud コンソールでメトリクスを確認
- [ ] Prometheus/Grafana をインストール（オプション）
- [ ] New Relic をインストール（オプション）
- [ ] Datadog をインストール（オプション）

## セキュリティ検証

### ファイアウォール
- [ ] ファイアウォールルールが正しく設定されているか確認
- [ ] 不要なポートが閉じられているか確認
- [ ] SSH ポートが制限されているか確認

### SSL/TLS セキュリティ
- [ ] SSL テストを実行（https://www.ssllabs.com）
- [ ] セキュリティスコアが A 以上か確認
- [ ] 弱い暗号が無効化されているか確認
- [ ] HSTS が有効化されているか確認

### アプリケーションセキュリティ
- [ ] SQL インジェクション対策が実装されているか確認
- [ ] XSS 対策が実装されているか確認
- [ ] CSRF 対策が実装されているか確認
- [ ] 認証が実装されているか確認
- [ ] 認可が実装されているか確認

### 依存関係セキュリティ
- [ ] 依存関係の脆弱性をスキャン（npm audit）
- [ ] 依存関係の脆弱性をスキャン（pip audit）
- [ ] 脆弱性がある場合は更新

## ドキュメント

### ドキュメント完成
- [ ] README.md が最新か確認
- [ ] API_DOCS.md が最新か確認
- [ ] SETUP_GUIDE.md が最新か確認
- [ ] HETZNER_DEPLOYMENT.md が最新か確認
- [ ] トラブルシューティングガイドが完成しているか確認

### ドキュメント共有
- [ ] チームメンバーにドキュメントを共有
- [ ] ドキュメントが理解しやすいか確認
- [ ] 不足している情報がないか確認

## 本番環境確認

### 最終チェック
- [ ] すべてのテストが成功しているか確認
- [ ] パフォーマンスが許容範囲か確認
- [ ] セキュリティが適切か確認
- [ ] バックアップが機能しているか確認
- [ ] モニタリングが機能しているか確認

### ユーザーテスト
- [ ] 複数のユーザーでテスト
- [ ] 異なるデバイスでテスト
- [ ] 異なるネットワーク環境でテスト
- [ ] ユーザーフィードバックを収集

### 本番環境への移行
- [ ] 本番環境への移行計画を作成
- [ ] ダウンタイムを最小化する計画を立案
- [ ] ロールバック計画を準備
- [ ] チームに通知

## 部署後の監視

### 初期監視（最初の 24 時間）
- [ ] ログを監視
- [ ] エラーレートを監視
- [ ] パフォーマンスを監視
- [ ] ユーザーフィードバックを監視

### 継続的監視
- [ ] 日次ログレビュー
- [ ] 週次パフォーマンスレビュー
- [ ] 月次セキュリティレビュー
- [ ] 四半期ごとの容量計画

## チェックリスト完了

- [ ] すべてのチェック項目が完了
- [ ] 本番環境が安定して動作している
- [ ] ユーザーが正常にアクセスできている
- [ ] バックアップと復旧が機能している
- [ ] モニタリングが機能している

**部署完了日**：________________
**部署担当者**：________________
**レビュー担当者**：________________

---

**最終更新**：2026年2月11日
